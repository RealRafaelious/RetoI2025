import pandas as pd
import matplotlib.pyplot as plt
import seaborn as sns

# Cargar archivo
df = pd.read_excel(r"D:\UCU\Reto 1\TablasActuales\UNION.xlsx")

# Filtrar columnas necesarias y eliminar nulos
df_filtrado = df[["id_unico_docente", "dias_de_conexion_dispositivo", "sexo_docente"]].dropna()

# Agrupar por docente
resumen = df_filtrado.groupby("id_unico_docente").agg(
    count=('dias_de_conexion_dispositivo', 'count'),
    mean=('dias_de_conexion_dispositivo', 'mean'),
    std=('dias_de_conexion_dispositivo', 'std'),
    sexo=('sexo_docente', 'first')  # Suponemos que el sexo es el mismo por docente
).reset_index()

# Calcular coeficiente de variación (CV = std/mean)
resumen['cv'] = resumen['std'] / resumen['mean']

# Mostrar estadísticas descriptivas
print("Estadísticas del coeficiente de variación:")
print(f"CV promedio: {resumen['cv'].mean():.2f}")
print(f"CV mediano: {resumen['cv'].median():.2f}")
print(f"CV mínimo: {resumen['cv'].min():.2f}")
print(f"CV máximo: {resumen['cv'].max():.2f}")
print("\nInterpretación:")
print("CV < 0.2: Poca variabilidad")
print("CV 0.2-0.5: Variabilidad moderada") 
print("CV > 0.5: Alta variabilidad")

# Graficar scatterplot
plt.figure(figsize=(12, 7))
sns.scatterplot(
    data=resumen,
    x='mean',
    y='std',
    size='count',
    hue='sexo',
    palette={'M': '#00809D', 'F': '#D92C54'}, 
    sizes=(20, 300),  # Tamaño mínimo y máximo de burbujas
    alpha=0.7,
    edgecolor='black'
)

plt.title("Variabilidad de uso de estudiantes según docente", fontsize=14)
plt.xlabel("Promedio de días de conexión (estudiantes del docente)")
plt.ylabel("Desviación estándar (varianza entre estudiantes)")
plt.grid(True, linestyle='--', alpha=0.5)
plt.legend(title="Sexo del docente", loc='upper right')
plt.tight_layout()
plt.show()
